	github.com/AlmatJuvashev/phd-students-portal/backend/cmd/clean_test_data		coverage: 0.0% of statements
	github.com/AlmatJuvashev/phd-students-portal/backend/cmd/mock		coverage: 0.0% of statements
	github.com/AlmatJuvashev/phd-students-portal/backend/cmd/seed_demo_progress		coverage: 0.0% of statements
	github.com/AlmatJuvashev/phd-students-portal/backend/cmd/seed_multitenancy		coverage: 0.0% of statements
	github.com/AlmatJuvashev/phd-students-portal/backend/cmd/seed_playbook		coverage: 0.0% of statements
	github.com/AlmatJuvashev/phd-students-portal/backend/cmd/seed_test_users		coverage: 0.0% of statements
	github.com/AlmatJuvashev/phd-students-portal/backend/cmd/server		coverage: 0.0% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/auth	1.780s	coverage: 72.0% of statements
2025/12/24 16:25:04 Config loaded: Port=8280, Env=development, FrontendBase=http://localhost:5173, ServerURL=http://localhost:8080
--- FAIL: TestMustLoad_Defaults (0.00s)
    config_test.go:27: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/config/config_test.go:27
        	Error:      	Not equal: 
        	            	expected: "8080"
        	            	actual  : "8280"
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1 +1 @@
        	            	-8080
        	            	+8280
        	Test:       	TestMustLoad_Defaults
    config_test.go:29: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/config/config_test.go:29
        	Error:      	Not equal: 
        	            	expected: "change-me"
        	            	actual  : "super-secret-student-portal-data"
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1 +1 @@
        	            	-change-me
        	            	+super-secret-student-portal-data
        	Test:       	TestMustLoad_Defaults
    config_test.go:34: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/config/config_test.go:34
        	Error:      	Not equal: 
        	            	expected: "1025"
        	            	actual  : "1027"
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1 +1 @@
        	            	-1025
        	            	+1027
        	Test:       	TestMustLoad_Defaults
2025/12/24 16:25:04 Config loaded: Port=3000, Env=production, FrontendBase=http://localhost:5173, ServerURL=http://localhost:8080
2025/12/24 16:25:04 Config loaded: Port=8280, Env=development, FrontendBase=http://localhost:5173, ServerURL=http://localhost:8080
FAIL
coverage: 91.7% of statements
FAIL	github.com/AlmatJuvashev/phd-students-portal/backend/internal/config	0.841s
	github.com/AlmatJuvashev/phd-students-portal/backend/internal/db		coverage: 0.0% of statements
2025/12/24 16:25:07 [EMAIL] SMTP not configured - email features disabled
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

2025/12/24 16:25:07 [AuthService.Login] Attempting login for username=security_test_user, tenantID=
2025/12/24 16:25:07 [AuthService.Login] Found user: id=77ab8011-b83a-403f-ad89-bc4023fe90bf, role=student, isActive=true
2025/12/24 16:25:07 [AuthService.Login] Password verified for user=security_test_user
2025/12/24 16:25:07 [AuthService.Login] No tenant context, using user role=student
2025/12/24 16:25:07 [AuthService.Login] Login successful: userID=77ab8011-b83a-403f-ad89-bc4023fe90bf, role=student, tenantID=
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

2025/12/24 16:25:07 [AuthService.Login] Attempting login for username=security_test_user, tenantID=
2025/12/24 16:25:07 [AuthService.Login] Found user: id=77ab8011-b83a-403f-ad89-bc4023fe90bf, role=student, isActive=true
2025/12/24 16:25:07 [AuthService.Login] Password mismatch for user=security_test_user, hash_prefix=$2a$10$hLr3DzTQsyD0kIKe9WrpsOh
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

2025/12/24 16:25:07 [AuthService.Login] Attempting login for username=security_test_user, tenantID=
2025/12/24 16:25:07 [AuthService.Login] Found user: id=77ab8011-b83a-403f-ad89-bc4023fe90bf, role=student, isActive=true
2025/12/24 16:25:07 [AuthService.Login] Password mismatch for user=security_test_user, hash_prefix=$2a$10$hLr3DzTQsyD0kIKe9WrpsOh
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

2025/12/24 16:25:07 [AuthService.Login] Attempting login for username=security_test_user, tenantID=
2025/12/24 16:25:07 [AuthService.Login] User not found: username=security_test_user, error=record not found
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

2025/12/24 16:25:07 [AuthService.Login] Attempting login for username=security_test_user, tenantID=
2025/12/24 16:25:07 [AuthService.Login] User not found: username=security_test_user, error=record not found
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

2025/12/24 16:25:07 [AuthService.Login] Attempting login for username=security_test_user, tenantID=
2025/12/24 16:25:07 [AuthService.Login] User not found: username=security_test_user, error=record not found
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

2025/12/24 16:25:18 [ListNotifications] Starting - unreadOnly: false
2025/12/24 16:25:18 [ListNotifications] Found 2 notifications
2025/12/24 16:25:18 [ListNotifications] Starting - unreadOnly: true
2025/12/24 16:25:18 [ListNotifications] Found 0 notifications
--- FAIL: TestNotificationsHandler_ListNotifications (7.28s)
    --- FAIL: TestNotificationsHandler_ListNotifications/List_Unread_Only (0.09s)
        admin_notifications_test.go:63: 
            	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/handlers/admin_notifications_test.go:63
            	Error:      	"[]" should have 1 item(s), but has 0
            	Test:       	TestNotificationsHandler_ListNotifications/List_Unread_Only
panic: runtime error: index out of range [0] with length 0 [recovered]
	panic: runtime error: index out of range [0] with length 0

goroutine 54 [running]:
testing.tRunner.func1.2({0x1034ec6a0, 0x14000022f18})
	/opt/homebrew/Cellar/go/1.24.2/libexec/src/testing/testing.go:1734 +0x1ac
testing.tRunner.func1()
	/opt/homebrew/Cellar/go/1.24.2/libexec/src/testing/testing.go:1737 +0x334
panic({0x1034ec6a0?, 0x14000022f18?})
	/opt/homebrew/Cellar/go/1.24.2/libexec/src/runtime/panic.go:792 +0x124
github.com/AlmatJuvashev/phd-students-portal/backend/internal/handlers_test.TestNotificationsHandler_ListNotifications.func2(0x14000276c40)
	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/handlers/admin_notifications_test.go:64 +0x238
testing.tRunner(0x14000276c40, 0x14000264df0)
	/opt/homebrew/Cellar/go/1.24.2/libexec/src/testing/testing.go:1792 +0xe4
created by testing.(*T).Run in goroutine 43
	/opt/homebrew/Cellar/go/1.24.2/libexec/src/testing/testing.go:1851 +0x374
FAIL	github.com/AlmatJuvashev/phd-students-portal/backend/internal/handlers	13.509s
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/logging	1.140s	coverage: 100.0% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/middleware	47.557s	coverage: 53.8% of statements
	github.com/AlmatJuvashev/phd-students-portal/backend/internal/models		coverage: 0.0% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/permissions	1.641s	coverage: 93.5% of statements
2025/12/24 16:25:12 Failed to truncate table document_versions: pq: deadlock detected
2025/12/24 16:25:24 Failed to truncate table documents: pq: deadlock detected
2025/12/24 16:25:25 Failed to truncate table document_versions: pq: deadlock detected
2025/12/24 16:25:30 Failed to truncate table documents: pq: deadlock detected
2025/12/24 16:25:31 Failed to truncate table document_versions: pq: deadlock detected
--- FAIL: TestSQLAdminRepository_ListStudentsForMonitor (10.39s)
    admin_repository_test.go:77: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/repository/admin_repository_test.go:77
        	Error:      	"[]" should have 1 item(s), but has 0
        	Test:       	TestSQLAdminRepository_ListStudentsForMonitor
2025/12/24 16:25:39 Failed to truncate table document_versions: pq: deadlock detected
--- FAIL: TestSQLAdminRepository_GetStudentDetails (9.13s)
    admin_repository_test.go:105: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/repository/admin_repository_test.go:105
        	Error:      	Received unexpected error:
        	            	sql: no rows in result set
        	Test:       	TestSQLAdminRepository_GetStudentDetails
2025/12/24 16:25:44 Failed to truncate table document_versions: pq: deadlock detected
2025/12/24 16:25:46 Failed to truncate table users: pq: deadlock detected
--- FAIL: TestSQLAdminRepository_AdminNotifications (3.60s)
    admin_repository_test.go:146: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/repository/admin_repository_test.go:146
        	Error:      	Received unexpected error:
        	            	pq: insert or update on table "admin_notifications" violates foreign key constraint "admin_notifications_student_id_fkey"
        	Test:       	TestSQLAdminRepository_AdminNotifications
--- FAIL: TestSQLJourneyRepository_State (2.13s)
    journey_repository_test.go:36: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/repository/journey_repository_test.go:36
        	Error:      	Received unexpected error:
        	            	pq: insert or update on table "journey_states" violates foreign key constraint "journey_states_user_id_fkey"
        	Test:       	TestSQLJourneyRepository_State
--- FAIL: TestSQLJourneyRepository_NodeInstances (1.84s)
    journey_repository_test.go:60: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/repository/journey_repository_test.go:60
        	Error:      	Received unexpected error:
        	            	pq: insert or update on table "node_instances" violates foreign key constraint "node_instances_user_id_fkey"
        	Test:       	TestSQLJourneyRepository_NodeInstances
--- FAIL: TestSQLTenantRepository_Stats (2.52s)
    tenant_repository_test.go:136: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/repository/tenant_repository_test.go:136
        	Error:      	Received unexpected error:
        	            	pq: deadlock detected
        	Test:       	TestSQLTenantRepository_Stats
2025/12/24 16:26:07 Failed to truncate table users: pq: deadlock detected
--- FAIL: TestChatRepository_ListMembers (1.93s)
    chat_repository_test.go:163: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/repository/chat_repository_test.go:163
        	Error:      	"[{00000000-0000-0000-0000-000000000001 d38b0593-f69e-4be9-947f-46a00dbdd04f e9492735-a389-4d84-8725-59fda697ef1e member 2025-12-24 11:26:26.586068 +0000 UTC <nil> Test User chattest10@test.com chattest10}]" should have 2 item(s), but has 1
        	Test:       	TestChatRepository_ListMembers
FAIL
coverage: 13.9% of statements
FAIL	github.com/AlmatJuvashev/phd-students-portal/backend/internal/repository	90.422s
	github.com/AlmatJuvashev/phd-students-portal/backend/internal/seed		coverage: 0.0% of statements
2025/12/24 16:25:09 [EMAIL] Sent email to student@test.com: Reset Your Password
2025/12/24 16:25:09 [EMAIL] Skipping password reset email to student@test.com (SMTP not configured)
2025/12/24 16:25:09 [EMAIL] Failed to send email to new@test.com: smtp down
2025/12/24 16:25:09 [EMAIL] Sent email to user@test.com: You have been added to chat room: Research Room
2025/12/24 16:25:24 Failed to truncate table documents: pq: deadlock detected
2025/12/24 16:25:25 Failed to truncate table document_versions: pq: deadlock detected
--- FAIL: TestCalendarService_GetEvents (2.75s)
    services_test.go:311: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/services/services_test.go:311
        	Error:      	"[]" should have 1 item(s), but has 0
        	Test:       	TestCalendarService_GetEvents
--- FAIL: TestCalendarService_GetEvent (3.62s)
    services_test.go:337: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/services/services_test.go:337
        	Error:      	Received unexpected error:
        	            	pq: invalid input syntax for type uuid: ""
        	Test:       	TestCalendarService_GetEvent
--- FAIL: TestCalendarService_UpdateEvent (1.96s)
    services_test.go:366: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/services/services_test.go:366
        	Error:      	Received unexpected error:
        	            	event not found or unauthorized
        	Test:       	TestCalendarService_UpdateEvent
--- FAIL: TestAdminService_ListStudentProgress (2.95s)
    admin_service_test.go:63: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/services/admin_service_test.go:63
        	Error:      	"[]" should have 1 item(s), but has 0
        	Test:       	TestAdminService_ListStudentProgress
--- FAIL: TestAdminService_MonitorStudents (1.91s)
    admin_service_test.go:119: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/services/admin_service_test.go:119
        	Error:      	"[]" should have 1 item(s), but has 0
        	Test:       	TestAdminService_MonitorStudents
2025/12/24 16:26:23 [AuthService.Login] Attempting login for username=student1, tenantID=
2025/12/24 16:26:23 [AuthService.Login] Found user: id=u1, role=student, isActive=true
2025/12/24 16:26:23 [AuthService.Login] Password verified for user=student1
2025/12/24 16:26:23 [AuthService.Login] No tenant context, using user role=student
2025/12/24 16:26:23 [AuthService.Login] Login successful: userID=u1, role=student, tenantID=
2025/12/24 16:26:23 [AuthService.Login] Attempting login for username=advisor1, tenantID=t1
2025/12/24 16:26:23 [AuthService.Login] Found user: id=u2, role=student, isActive=true
2025/12/24 16:26:24 [AuthService.Login] Password verified for user=advisor1
2025/12/24 16:26:24 [AuthService.Login] Checking tenant membership: userID=u2, tenantID=t1
2025/12/24 16:26:24 [AuthService.Login] Tenant access granted: role=advisor
2025/12/24 16:26:24 [AuthService.Login] Login successful: userID=u2, role=advisor, tenantID=t1
2025/12/24 16:26:24 [AuthService.Login] Attempting login for username=user3, tenantID=
2025/12/24 16:26:24 [AuthService.Login] Found user: id=u3, role=, isActive=true
2025/12/24 16:26:24 [AuthService.Login] Password mismatch for user=user3, hash_prefix=$2a$10$Gd8zWOd1IHp86lv0.CL6S.J
2025/12/24 16:26:24 [AuthService.Login] Attempting login for username=user4, tenantID=
2025/12/24 16:26:24 [AuthService.Login] Found user: id=u4, role=, isActive=false
2025/12/24 16:26:24 [AuthService.Login] User inactive: id=u4
2025/12/24 16:26:31 [ActivateNextNodes] Starting for user=123e4567-e89b-12d3-a456-426614174000 node=node1
2025/12/24 16:26:33 [ActivateNextNodes] Starting for user=123e4567-e89b-12d3-a456-426614174001 node=fork
2025/12/24 16:26:35 [ActivateNextNodes] Starting for user=123e4567-e89b-12d3-a456-426614174002 node=terminal_node
2025/12/24 16:26:36 [ActivateNextNodes] Starting for user=123e4567-e89b-12d3-a456-426614174003 node=node1
2025/12/24 16:26:36 Activated existing node node2
2025/12/24 16:26:37 [ActivateNextNodes] Starting for user=user1 node=node1
2025/12/24 16:26:38 [ActivateNextNodes] Starting for user=123e4567-e89b-12d3-a456-426614174005 node=nonexistent_node
2025/12/24 16:26:39 [NotifyAdvisors] Found 2 advisors for student 11111111-1111-1111-1111-111111111111
2025/12/24 16:26:39 [NotifyAdvisors] Created submission notification for student 11111111-1111-1111-1111-111111111111, node node-1, 2 advisors assigned
2025/12/24 16:26:39 [NotifyAdvisors] Found 0 advisors for student 33333333-3333-3333-3333-333333333333
2025/12/24 16:26:39 [NotifyAdvisors] Double check existence: false
2025/12/24 16:26:39 [NotifyAdvisors] No advisors assigned to student 33333333-3333-3333-3333-333333333333, skipping notification
2025/12/24 16:26:42 Testing HasAdvisors with empty student, likely false
FAIL
coverage: 26.6% of statements
FAIL	github.com/AlmatJuvashev/phd-students-portal/backend/internal/services	101.295s
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/services/debouncer	3.494s	coverage: 59.4% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/services/mailer	5.082s	coverage: 60.6% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/services/playbook	41.509s	coverage: 69.1% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/storage	4.335s	coverage: 91.5% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/testutils	18.312s	coverage: 59.6% of statements
ok  	github.com/AlmatJuvashev/phd-students-portal/backend/internal/worker	31.291s	coverage: 65.3% of statements
FAIL
