=== RUN   TestAdminHandler_StudentProgress
=== RUN   TestAdminHandler_StudentProgress/List_Student_Progress
--- PASS: TestAdminHandler_StudentProgress (0.32s)
    --- PASS: TestAdminHandler_StudentProgress/List_Student_Progress (0.00s)
=== RUN   TestAdminHandler_MonitorStudents
=== RUN   TestAdminHandler_MonitorStudents/Admin_List_All
=== RUN   TestAdminHandler_MonitorStudents/Advisor_List_Assigned
=== RUN   TestAdminHandler_MonitorStudents/Advisor_List_Unassigned_(Empty)
=== RUN   TestAdminHandler_MonitorStudents/Filter_by_Program
=== RUN   TestAdminHandler_MonitorStudents/Filter_by_Wrong_Program
--- PASS: TestAdminHandler_MonitorStudents (0.31s)
    --- PASS: TestAdminHandler_MonitorStudents/Admin_List_All (0.01s)
    --- PASS: TestAdminHandler_MonitorStudents/Advisor_List_Assigned (0.01s)
    --- PASS: TestAdminHandler_MonitorStudents/Advisor_List_Unassigned_(Empty) (0.00s)
    --- PASS: TestAdminHandler_MonitorStudents/Filter_by_Program (0.01s)
    --- PASS: TestAdminHandler_MonitorStudents/Filter_by_Wrong_Program (0.00s)
=== RUN   TestAdminHandler_GetStudentDetails
=== RUN   TestAdminHandler_GetStudentDetails/Get_Details_Success
=== RUN   TestAdminHandler_GetStudentDetails/Get_Details_Not_Found
--- PASS: TestAdminHandler_GetStudentDetails (0.32s)
    --- PASS: TestAdminHandler_GetStudentDetails/Get_Details_Success (0.01s)
    --- PASS: TestAdminHandler_GetStudentDetails/Get_Details_Not_Found (0.00s)
=== RUN   TestAdminHandler_StudentJourney
=== RUN   TestAdminHandler_StudentJourney/Get_Student_Journey
--- PASS: TestAdminHandler_StudentJourney (0.28s)
    --- PASS: TestAdminHandler_StudentJourney/Get_Student_Journey (0.01s)
=== RUN   TestAdminHandler_ListStudentNodeFiles
    admin_progress_test.go:319: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/handlers/admin_progress_test.go:319
        	Error:      	Received unexpected error:
        	            	pq: column "status" of relation "node_instance_slots" does not exist
        	Test:       	TestAdminHandler_ListStudentNodeFiles
--- FAIL: TestAdminHandler_ListStudentNodeFiles (0.30s)
=== RUN   TestAdminHandler_MonitorAnalytics
=== RUN   TestAdminHandler_MonitorAnalytics/Get_Analytics
    admin_progress_test.go:386: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/handlers/admin_progress_test.go:386
        	Error:      	Not equal: 
        	            	expected: float64(1)
        	            	actual  : <nil>(<nil>)
        	Test:       	TestAdminHandler_MonitorAnalytics/Get_Analytics
--- FAIL: TestAdminHandler_MonitorAnalytics (0.30s)
    --- FAIL: TestAdminHandler_MonitorAnalytics/Get_Analytics (0.00s)
=== RUN   TestAdminHandler_ReviewAttachment
    admin_progress_test.go:429: 
        	Error Trace:	/Users/almatjuvashev/Documents/Projects/KazNMU/kaznmu_phd_bot/checklist/phd-student-portal-starter-v8/backend/internal/handlers/admin_progress_test.go:429
        	Error:      	Received unexpected error:
        	            	pq: null value in column "document_version_id" of relation "node_instance_slot_attachments" violates not-null constraint
        	Test:       	TestAdminHandler_ReviewAttachment
--- FAIL: TestAdminHandler_ReviewAttachment (0.35s)
=== RUN   TestAuthHandler_Login
=== RUN   TestAuthHandler_Login/Successful_Login
    auth_test.go:51: Response body: {"role":"student","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NjUwNDA2MzAsImlhdCI6MTc2NDk1NDIzMCwicm9sZSI6InN0dWRlbnQiLCJzdWIiOiIxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAifQ.pYkLLzjPl1cUkqZZ9QgxWQFoslvN22vEcwzvBhTOoVg"}
=== RUN   TestAuthHandler_Login/Invalid_Password
=== RUN   TestAuthHandler_Login/User_Not_Found
--- PASS: TestAuthHandler_Login (0.68s)
    --- PASS: TestAuthHandler_Login/Successful_Login (0.07s)
    --- PASS: TestAuthHandler_Login/Invalid_Password (0.07s)
    --- PASS: TestAuthHandler_Login/User_Not_Found (0.00s)
=== RUN   TestCalendarHandler_CreateEvent
=== RUN   TestCalendarHandler_CreateEvent/Create_Event_Success
--- PASS: TestCalendarHandler_CreateEvent (0.29s)
    --- PASS: TestCalendarHandler_CreateEvent/Create_Event_Success (0.00s)
=== RUN   TestCalendarHandler_GetEvents
=== RUN   TestCalendarHandler_GetEvents/Get_Events
--- PASS: TestCalendarHandler_GetEvents (0.27s)
    --- PASS: TestCalendarHandler_GetEvents/Get_Events (0.00s)
=== RUN   TestCalendarHandler_UpdateDelete
=== RUN   TestCalendarHandler_UpdateDelete/Update_Event
2025/12/05 22:03:52 [UpdateEvent] Updating event a23dc262-5ae0-4728-9d81-e60c5db9f871 for user 11111111-1111-1111-1111-111111111111
2025/12/05 22:03:52 [UpdateEvent] Request data: title=New Title, start=2025-12-05T22:03:52+05:00, end=2025-12-05T23:03:52+05:00, type=academic
2025/12/05 22:03:52 [UpdateEvent] Event a23dc262-5ae0-4728-9d81-e60c5db9f871 updated successfully
=== RUN   TestCalendarHandler_UpdateDelete/Delete_Event
--- PASS: TestCalendarHandler_UpdateDelete (0.29s)
    --- PASS: TestCalendarHandler_UpdateDelete/Update_Event (0.00s)
    --- PASS: TestCalendarHandler_UpdateDelete/Delete_Event (0.00s)
=== RUN   TestChatHandler_RoomManagement
=== RUN   TestChatHandler_RoomManagement/Update_Room
=== RUN   TestChatHandler_RoomManagement/List_Rooms_(Empty_initially)
--- PASS: TestChatHandler_RoomManagement (0.29s)
    --- PASS: TestChatHandler_RoomManagement/Update_Room (0.00s)
    --- PASS: TestChatHandler_RoomManagement/List_Rooms_(Empty_initially) (0.00s)
=== RUN   TestChatHandler_Members
=== RUN   TestChatHandler_Members/Add_Member
=== RUN   TestChatHandler_Members/List_Members
=== RUN   TestChatHandler_Members/Remove_Member
--- PASS: TestChatHandler_Members (0.32s)
    --- PASS: TestChatHandler_Members/Add_Member (0.00s)
    --- PASS: TestChatHandler_Members/List_Members (0.00s)
    --- PASS: TestChatHandler_Members/Remove_Member (0.00s)
=== RUN   TestChatHandler_MessageOperations
=== RUN   TestChatHandler_MessageOperations/Update_Message
=== RUN   TestChatHandler_MessageOperations/Mark_As_Read
=== RUN   TestChatHandler_MessageOperations/Delete_Message
--- PASS: TestChatHandler_MessageOperations (0.26s)
    --- PASS: TestChatHandler_MessageOperations/Update_Message (0.00s)
    --- PASS: TestChatHandler_MessageOperations/Mark_As_Read (0.00s)
    --- PASS: TestChatHandler_MessageOperations/Delete_Message (0.00s)
=== RUN   TestChatHandler_CreateRoom
=== RUN   TestChatHandler_CreateRoom/Create_Room_Success
--- PASS: TestChatHandler_CreateRoom (0.27s)
    --- PASS: TestChatHandler_CreateRoom/Create_Room_Success (0.00s)
=== RUN   TestChatHandler_Messages
=== RUN   TestChatHandler_Messages/Send_Message
=== RUN   TestChatHandler_Messages/List_Messages
--- PASS: TestChatHandler_Messages (0.26s)
    --- PASS: TestChatHandler_Messages/Send_Message (0.00s)
    --- PASS: TestChatHandler_Messages/List_Messages (0.00s)
=== RUN   TestDictionaryHandler_Programs
=== RUN   TestDictionaryHandler_Programs/Create_Program
=== RUN   TestDictionaryHandler_Programs/List_Programs
--- PASS: TestDictionaryHandler_Programs (0.24s)
    --- PASS: TestDictionaryHandler_Programs/Create_Program (0.00s)
    --- PASS: TestDictionaryHandler_Programs/List_Programs (0.00s)
=== RUN   TestDictionaryHandler_Departments
=== RUN   TestDictionaryHandler_Departments/Create_Department
=== RUN   TestDictionaryHandler_Departments/List_Departments
--- PASS: TestDictionaryHandler_Departments (0.26s)
    --- PASS: TestDictionaryHandler_Departments/Create_Department (0.00s)
    --- PASS: TestDictionaryHandler_Departments/List_Departments (0.00s)
=== RUN   TestDictionaryHandler_Cohorts
=== RUN   TestDictionaryHandler_Cohorts/Create_Cohort
=== RUN   TestDictionaryHandler_Cohorts/List_Cohorts
=== RUN   TestDictionaryHandler_Cohorts/Update_Cohort
=== RUN   TestDictionaryHandler_Cohorts/Delete_Cohort
--- PASS: TestDictionaryHandler_Cohorts (0.33s)
    --- PASS: TestDictionaryHandler_Cohorts/Create_Cohort (0.00s)
    --- PASS: TestDictionaryHandler_Cohorts/List_Cohorts (0.00s)
    --- PASS: TestDictionaryHandler_Cohorts/Update_Cohort (0.00s)
    --- PASS: TestDictionaryHandler_Cohorts/Delete_Cohort (0.00s)
=== RUN   TestDictionaryHandler_Specialties
=== RUN   TestDictionaryHandler_Specialties/List_Specialties
--- PASS: TestDictionaryHandler_Specialties (0.50s)
    --- PASS: TestDictionaryHandler_Specialties/List_Specialties (0.00s)
=== RUN   TestDocumentsHandler_List
=== RUN   TestDocumentsHandler_List/List_Documents
--- PASS: TestDocumentsHandler_List (0.33s)
    --- PASS: TestDocumentsHandler_List/List_Documents (0.00s)
=== RUN   TestDocumentsHandler_Upload
=== RUN   TestDocumentsHandler_Upload/Upload_Document_Version
--- PASS: TestDocumentsHandler_Upload (0.51s)
    --- PASS: TestDocumentsHandler_Upload/Upload_Document_Version (0.00s)
=== RUN   TestDocumentsHandler_Delete
=== RUN   TestDocumentsHandler_Delete/Delete_Document
--- PASS: TestDocumentsHandler_Delete (0.28s)
    --- PASS: TestDocumentsHandler_Delete/Delete_Document (0.00s)
=== RUN   TestDocumentsHandler_Get
=== RUN   TestDocumentsHandler_Get/Get_Document
    documents_test.go:178: Response Code: 200
    documents_test.go:179: Response Body: {"doc":{"id":"d05a4547-546a-41f0-a25b-3ef8396d87cb","user_id":"30000000-0000-0000-0000-000000000004","title":"Get Doc","kind":"other","current_version_id":null},"versions":null}
--- PASS: TestDocumentsHandler_Get (0.29s)
    --- PASS: TestDocumentsHandler_Get/Get_Document (0.00s)
=== RUN   TestNodeSubmissionHandler_GetSubmission
=== RUN   TestNodeSubmissionHandler_GetSubmission/Get_New_Submission
2025/12/05 22:03:56 [fetchSlots] instanceID=ffc98fe1-a02e-4215-9bbe-c6a2be69cb6a
2025/12/05 22:03:56 [fetchSlots] returning 0 slots with total attachments
    journey_test.go:67: Response: map[locale:ru node_id:node1 playbook_version_id:22222222-2222-2222-2222-222222222222 slots:[] state:active]
--- PASS: TestNodeSubmissionHandler_GetSubmission (0.29s)
    --- PASS: TestNodeSubmissionHandler_GetSubmission/Get_New_Submission (0.01s)
=== RUN   TestNodeSubmissionHandler_PutSubmission
=== RUN   TestNodeSubmissionHandler_PutSubmission/Update_Submission
2025/12/05 22:03:56 [fetchSlots] instanceID=4e19ddee-4488-4c5d-b262-622f93880f55
2025/12/05 22:03:56 [fetchSlots] returning 0 slots with total attachments
--- PASS: TestNodeSubmissionHandler_PutSubmission (0.40s)
    --- PASS: TestNodeSubmissionHandler_PutSubmission/Update_Submission (0.01s)
=== RUN   TestInvalidNodeID
--- PASS: TestInvalidNodeID (0.25s)
=== RUN   TestUnauthorizedUser
    node_errors_test.go:104: Unauthorized response: {"error":"unauthorized"}
--- PASS: TestUnauthorizedUser (0.25s)
=== RUN   TestMalformedJSON
2025/12/05 22:03:57 [fetchSlots] instanceID=95dcdcc6-3783-4230-abf1-584eb05403be
2025/12/05 22:03:57 [fetchSlots] returning 0 slots with total attachments
    node_errors_test.go:160: Malformed JSON response: {"error":"invalid character 'o' in literal null (expecting 'u')"}
--- PASS: TestMalformedJSON (0.28s)
=== RUN   TestInvalidStateTransition
2025/12/05 22:03:57 [fetchSlots] instanceID=432d59ab-bcd5-4872-b4fa-c11188bd5810
2025/12/05 22:03:57 [fetchSlots] returning 0 slots with total attachments
    node_errors_test.go:216: Invalid state transition response: {"error":"transition not allowed"}
--- PASS: TestInvalidStateTransition (0.27s)
=== RUN   TestLockedState_CantSubmit
2025/12/05 22:03:58 [fetchSlots] instanceID=cad587db-2f98-4001-83a8-7a211f93d1a5
2025/12/05 22:03:58 [fetchSlots] returning 0 slots with total attachments
    node_state_full_test.go:84: Locked node response: {"error":"transition not allowed"}
--- PASS: TestLockedState_CantSubmit (0.27s)
=== RUN   TestWaitingState_CantAdvance
2025/12/05 22:03:58 [fetchSlots] instanceID=73a5b2c3-239f-49bc-b350-a29211062ef2
2025/12/05 22:03:58 [fetchSlots] returning 0 slots with total attachments
    node_state_full_test.go:148: Waiting node response: {"error":"transition not allowed"}
--- PASS: TestWaitingState_CantAdvance (0.27s)
=== RUN   TestFullStateFlow
2025/12/05 22:03:58 [fetchSlots] instanceID=e5003ee7-3821-4a85-93e2-f18b2adfb703
2025/12/05 22:03:58 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:58 [fetchSlots] instanceID=e5003ee7-3821-4a85-93e2-f18b2adfb703
2025/12/05 22:03:58 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:58 Failed to send email to juvashev@gmail.com: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:03:58 [sendStateChangeEmail] Error sending email to admin: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:03:58 [fetchSlots] instanceID=e5003ee7-3821-4a85-93e2-f18b2adfb703
2025/12/05 22:03:58 [fetchSlots] returning 0 slots with total attachments
    node_state_full_test.go:220: Done transition response: {"locale":"ru","node_id":"flow_node","playbook_version_id":"ffffffff-ffff-ffff-ffff-ffffffffffff","slots":[],"state":"done"}
--- PASS: TestFullStateFlow (0.33s)
=== RUN   TestNeedsFixes_Resubmit
2025/12/05 22:03:59 [fetchSlots] instanceID=ff1ec312-e145-4fbe-8199-40466a182799
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 [fetchSlots] instanceID=ff1ec312-e145-4fbe-8199-40466a182799
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 Failed to send email to juvashev@gmail.com: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:03:59 [sendStateChangeEmail] Error sending email to admin: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:03:59 Failed to send email to juvashev@gmail.com: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:03:59 [sendStateChangeEmail] Error sending email to admin: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:03:59 [fetchSlots] instanceID=ff1ec312-e145-4fbe-8199-40466a182799
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
--- PASS: TestNeedsFixes_Resubmit (0.29s)
=== RUN   TestNodeStateTransitions_StudentSubmitsNode
2025/12/05 22:03:59 [fetchSlots] instanceID=cb68c280-411a-4db2-aaad-ccbc8ea8d9d6
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 [fetchSlots] instanceID=cb68c280-411a-4db2-aaad-ccbc8ea8d9d6
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 [sendStateChangeEmail] Error fetching user: sql: no rows in result set
--- PASS: TestNodeStateTransitions_StudentSubmitsNode (0.30s)
=== RUN   TestNodeStateTransitions_StudentCannotDirectlyApprove
2025/12/05 22:03:59 [fetchSlots] instanceID=f2f7ba3d-d152-4899-92d0-bf009c600583
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 [fetchSlots] instanceID=f2f7ba3d-d152-4899-92d0-bf009c600583
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 [sendStateChangeEmail] Error fetching user: sql: no rows in result set
--- PASS: TestNodeStateTransitions_StudentCannotDirectlyApprove (0.28s)
=== RUN   TestNodeStateTransitions_AdminApprovesNode
2025/12/05 22:03:59 [fetchSlots] instanceID=1f1f05c2-1478-4010-900d-8f279f3de255
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 [fetchSlots] instanceID=1f1f05c2-1478-4010-900d-8f279f3de255
2025/12/05 22:03:59 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:03:59 Failed to send email to juvashev@gmail.com: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:03:59 [sendStateChangeEmail] Error sending email to admin: dial tcp [::1]:1027: connect: connection refused
    node_state_transitions_test.go:198: Admin approval response: {"error":"transition not allowed"}
--- PASS: TestNodeStateTransitions_AdminApprovesNode (0.30s)
=== RUN   TestNodeStateTransitions_AdvisorRequestsFixes
2025/12/05 22:04:00 [fetchSlots] instanceID=bde422c7-97b3-41e8-bdab-8d5c608219a1
2025/12/05 22:04:00 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:04:00 [fetchSlots] instanceID=bde422c7-97b3-41e8-bdab-8d5c608219a1
2025/12/05 22:04:00 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:04:00 Failed to send email to juvashev@gmail.com: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:04:00 [sendStateChangeEmail] Error sending email to admin: dial tcp [::1]:1027: connect: connection refused
--- PASS: TestNodeStateTransitions_AdvisorRequestsFixes (0.30s)
=== RUN   TestNodeStateTransitions_StudentResubmitsAfterFixes
2025/12/05 22:04:00 [fetchSlots] instanceID=392ad6b7-40db-4b4e-a332-0a369b6dce13
2025/12/05 22:04:00 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:04:00 [fetchSlots] instanceID=392ad6b7-40db-4b4e-a332-0a369b6dce13
2025/12/05 22:04:00 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:04:00 Failed to send email to juvashev@gmail.com: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:04:00 [sendStateChangeEmail] Error sending email to admin: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:04:00 [fetchSlots] instanceID=392ad6b7-40db-4b4e-a332-0a369b6dce13
2025/12/05 22:04:00 Failed to send email to juvashev@gmail.com: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:04:00 [sendStateChangeEmail] Error sending email to admin: dial tcp [::1]:1027: connect: connection refused
2025/12/05 22:04:00 [fetchSlots] returning 0 slots with total attachments
--- PASS: TestNodeStateTransitions_StudentResubmitsAfterFixes (0.29s)
=== RUN   TestNodeStateTransitions_InvalidStateRejected
2025/12/05 22:04:00 [fetchSlots] instanceID=6a73574c-f7fb-4ada-8c54-8424013e1d1d
2025/12/05 22:04:00 [fetchSlots] returning 0 slots with total attachments
--- PASS: TestNodeStateTransitions_InvalidStateRejected (0.33s)
=== RUN   TestNodeStateTransitions_EventsLogged
2025/12/05 22:04:01 [fetchSlots] instanceID=2fc0a901-0175-401a-a662-7a926689c142
2025/12/05 22:04:01 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:04:01 [fetchSlots] instanceID=2fc0a901-0175-401a-a662-7a926689c142
2025/12/05 22:04:01 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:04:01 [sendStateChangeEmail] Error fetching user: sql: no rows in result set
--- PASS: TestNodeStateTransitions_EventsLogged (0.28s)
=== RUN   TestFormNode_GetSubmission
2025/12/05 22:04:01 [fetchSlots] instanceID=9af8293b-84f6-40a8-b492-fc66814d10fa
2025/12/05 22:04:01 [fetchSlots] returning 0 slots with total attachments
    node_types_test.go:69: Form node response: map[locale:ru node_id:form_node playbook_version_id:22222222-2222-2222-2222-222222222222 slots:[] state:active]
--- PASS: TestFormNode_GetSubmission (0.27s)
=== RUN   TestConfirmTaskNode_GetSubmission
2025/12/05 22:04:01 [fetchSlots] instanceID=ac7b77eb-d717-4db4-85db-254672a7e754
2025/12/05 22:04:01 [fetchSlots] row 1: slot=document attachment_id= version_id= is_active=false reviewed_doc_id=
2025/12/05 22:04:01 [fetchSlots] returning 1 slots with total attachments
    node_types_test.go:130: ConfirmTask slots: [map[attachments:[] key:document mime:[] multiplicity:single required:true]]
    node_types_test.go:132: ConfirmTask node response: map[locale:ru node_id:confirm_node playbook_version_id:44444444-4444-4444-4444-444444444444 slots:[map[attachments:[] key:document mime:[] multiplicity:single required:true]] state:active]
--- PASS: TestConfirmTaskNode_GetSubmission (0.30s)
=== RUN   TestInfoNode_GetSubmission
2025/12/05 22:04:02 [fetchSlots] instanceID=854d7143-cd6a-4f4d-9593-286367cbcacd
2025/12/05 22:04:02 [fetchSlots] returning 0 slots with total attachments
    node_types_test.go:184: Info node response: map[locale:ru node_id:info_node playbook_version_id:66666666-6666-6666-6666-666666666666 slots:[] state:active]
--- PASS: TestInfoNode_GetSubmission (0.26s)
=== RUN   TestFormNode_PutSubmission
2025/12/05 22:04:02 [fetchSlots] instanceID=11f9009b-ef5c-4264-9691-08f8e909702f
2025/12/05 22:04:02 [fetchSlots] returning 0 slots with total attachments
2025/12/05 22:04:02 [fetchSlots] instanceID=11f9009b-ef5c-4264-9691-08f8e909702f
2025/12/05 22:04:02 [fetchSlots] returning 0 slots with total attachments
--- PASS: TestFormNode_PutSubmission (0.26s)
=== RUN   TestPresignUpload_Success
2025/12/05 22:04:02 [fetchSlots] instanceID=118774ac-02ea-408b-b232-ad779391eadd
2025/12/05 22:04:02 [fetchSlots] row 1: slot=doc_slot attachment_id= version_id= is_active=false reviewed_doc_id=
2025/12/05 22:04:02 [fetchSlots] returning 1 slots with total attachments
2025/12/05 22:04:02 [S3] Presigning PUT for key=nodes/11111111-aaaa-1111-1111-111111111111/upload_node/doc_slot/20251205-4e63192a-a323-43f0-b784-2e4fb21e2a8f-test.pdf bucket=phd-portal expires=15m0s
    node_upload_test.go:89: Presign success: map[bucket:phd-portal document_id:e5238c3f-579e-4900-a3d4-949099e1be9e expires_in:900 max_size_bytes:1.048576e+07 object_key:nodes/11111111-aaaa-1111-1111-111111111111/upload_node/doc_slot/20251205-4e63192a-a323-43f0-b784-2e4fb21e2a8f-test.pdf required_headers:map[Content-Type:application/pdf] upload_url:http://localhost:9090/phd-portal/nodes/11111111-aaaa-1111-1111-111111111111/upload_node/doc_slot/20251205-4e63192a-a323-43f0-b784-2e4fb21e2a8f-test.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=minioadmin%2F20251205%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251205T170402Z&X-Amz-Expires=900&X-Amz-SignedHeaders=host&x-id=PutObject&X-Amz-Signature=c50f62862a5d75381dd8d2e8dbd46b4a25633c097e457e768310bd0d92fbd5c4]
--- PASS: TestPresignUpload_Success (0.26s)
=== RUN   TestUpload_InvalidMime
2025/12/05 22:04:02 [fetchSlots] instanceID=a5d21ac9-af7e-4dad-aca3-91f1709130c0
2025/12/05 22:04:02 [fetchSlots] row 1: slot=pdf_only attachment_id= version_id= is_active=false reviewed_doc_id=
2025/12/05 22:04:02 [fetchSlots] returning 1 slots with total attachments
    node_upload_test.go:160: Invalid MIME response: {"error":"invalid mime type"}
--- PASS: TestUpload_InvalidMime (0.27s)
=== RUN   TestUpload_SizeTooLarge
2025/12/05 22:04:03 [fetchSlots] instanceID=c231e592-0e4b-44fa-96c8-d04d7673d0ce
2025/12/05 22:04:03 [fetchSlots] row 1: slot=small_file attachment_id= version_id= is_active=false reviewed_doc_id=
2025/12/05 22:04:03 [fetchSlots] returning 1 slots with total attachments
    node_upload_test.go:229: Size too large response: {"error":"file too large (max 1 MB)"}
--- PASS: TestUpload_SizeTooLarge (0.33s)
=== RUN   TestNotificationsHandler_Admin
=== RUN   TestNotificationsHandler_Admin/List_Notifications
2025/12/05 22:04:03 [ListNotifications] Starting - unreadOnly: false
2025/12/05 22:04:03 [ListNotifications] Executing query: 
		SELECT 
			n.id,
			n.student_id,
			COALESCE(u.first_name || ' ' || u.last_name, 'Unknown') as student_name,
			COALESCE(u.email, '') as student_email,
			n.node_id,
			COALESCE(n.node_instance_id::text, '') as node_instance_id,
			n.event_type,
			n.is_read,
			n.message,
			n.metadata::text as metadata,
			to_char(n.created_at, 'YYYY-MM-DD"T"HH24:MI:SS"Z"') as created_at
		FROM admin_notifications n
		JOIN users u ON u.id = n.student_id
	 ORDER BY n.created_at DESC LIMIT 100
2025/12/05 22:04:03 [ListNotifications] Found 2 notifications
2025/12/05 22:04:03 [ListNotifications] First notification: id=a3a886fa-a411-4465-b4e4-4150195dc0cd, student=Student One, node=node1, message=Student submitted node1
2025/12/05 22:04:03 [ListNotifications] Returning 2 notifications
=== RUN   TestNotificationsHandler_Admin/List_Unread_Only
2025/12/05 22:04:03 [ListNotifications] Starting - unreadOnly: true
2025/12/05 22:04:03 [ListNotifications] Executing query: 
		SELECT 
			n.id,
			n.student_id,
			COALESCE(u.first_name || ' ' || u.last_name, 'Unknown') as student_name,
			COALESCE(u.email, '') as student_email,
			n.node_id,
			COALESCE(n.node_instance_id::text, '') as node_instance_id,
			n.event_type,
			n.is_read,
			n.message,
			n.metadata::text as metadata,
			to_char(n.created_at, 'YYYY-MM-DD"T"HH24:MI:SS"Z"') as created_at
		FROM admin_notifications n
		JOIN users u ON u.id = n.student_id
	 WHERE n.is_read = false ORDER BY n.created_at DESC LIMIT 100
2025/12/05 22:04:03 [ListNotifications] Found 1 notifications
2025/12/05 22:04:03 [ListNotifications] First notification: id=a3a886fa-a411-4465-b4e4-4150195dc0cd, student=Student One, node=node1, message=Student submitted node1
2025/12/05 22:04:03 [ListNotifications] Returning 1 notifications
=== RUN   TestNotificationsHandler_Admin/Get_Unread_Count
=== RUN   TestNotificationsHandler_Admin/Mark_As_Read
=== RUN   TestNotificationsHandler_Admin/Mark_All_As_Read
--- PASS: TestNotificationsHandler_Admin (0.24s)
    --- PASS: TestNotificationsHandler_Admin/List_Notifications (0.00s)
    --- PASS: TestNotificationsHandler_Admin/List_Unread_Only (0.00s)
    --- PASS: TestNotificationsHandler_Admin/Get_Unread_Count (0.00s)
    --- PASS: TestNotificationsHandler_Admin/Mark_As_Read (0.00s)
    --- PASS: TestNotificationsHandler_Admin/Mark_All_As_Read (0.00s)
=== RUN   TestNotificationHandler_Student_MarkAllAsRead
--- PASS: TestNotificationHandler_Student_MarkAllAsRead (0.25s)
=== RUN   TestNotificationHandler_GetUnread
=== RUN   TestNotificationHandler_GetUnread/Get_Unread
2025/12/05 22:04:03 [GetUnread reqID=1764954243921760000] Handler called
2025/12/05 22:04:03 [GetUnread reqID=1764954243921760000] userID from context: '123e4567-e89b-12d3-a456-426614174000'
2025/12/05 22:04:03 [GetUnread reqID=1764954243921760000] returning 1 notifications
--- PASS: TestNotificationHandler_GetUnread (0.24s)
    --- PASS: TestNotificationHandler_GetUnread/Get_Unread (0.00s)
=== RUN   TestNotificationHandler_MarkAsRead
=== RUN   TestNotificationHandler_MarkAsRead/Mark_As_Read
--- PASS: TestNotificationHandler_MarkAsRead (0.27s)
    --- PASS: TestNotificationHandler_MarkAsRead/Mark_As_Read (0.00s)
=== RUN   TestSearchHandler_GlobalSearch
=== RUN   TestSearchHandler_GlobalSearch/Admin_Search_Users
=== RUN   TestSearchHandler_GlobalSearch/Admin_Search_Documents
=== RUN   TestSearchHandler_GlobalSearch/Student_Search_Own_Document
=== RUN   TestSearchHandler_GlobalSearch/Student_Cannot_Search_Users
--- PASS: TestSearchHandler_GlobalSearch (0.28s)
    --- PASS: TestSearchHandler_GlobalSearch/Admin_Search_Users (0.00s)
    --- PASS: TestSearchHandler_GlobalSearch/Admin_Search_Documents (0.00s)
    --- PASS: TestSearchHandler_GlobalSearch/Student_Search_Own_Document (0.00s)
    --- PASS: TestSearchHandler_GlobalSearch/Student_Cannot_Search_Users (0.00s)
=== RUN   TestUsersHandler_UpdateUser
--- PASS: TestUsersHandler_UpdateUser (0.25s)
=== RUN   TestUsersHandler_ChangeOwnPassword
--- PASS: TestUsersHandler_ChangeOwnPassword (0.86s)
=== RUN   TestUsersHandler_ResetPasswordForUser
--- PASS: TestUsersHandler_ResetPasswordForUser (0.42s)
=== RUN   TestUsersHandler_UpdateMe
--- PASS: TestUsersHandler_UpdateMe (0.40s)
=== RUN   TestUsersHandler_UpdateMe_RateLimit
--- PASS: TestUsersHandler_UpdateMe_RateLimit (0.51s)
=== RUN   TestUsersHandler_CreateUser
=== RUN   TestUsersHandler_CreateUser/Create_Student_Success
--- PASS: TestUsersHandler_CreateUser (0.33s)
    --- PASS: TestUsersHandler_CreateUser/Create_Student_Success (0.07s)
=== RUN   TestUsersHandler_ListUsers
=== RUN   TestUsersHandler_ListUsers/List_All_Users
=== RUN   TestUsersHandler_ListUsers/Filter_by_Role
--- PASS: TestUsersHandler_ListUsers (0.35s)
    --- PASS: TestUsersHandler_ListUsers/List_All_Users (0.00s)
    --- PASS: TestUsersHandler_ListUsers/Filter_by_Role (0.00s)
FAIL
FAIL	github.com/AlmatJuvashev/phd-students-portal/backend/internal/handlers	20.122s
FAIL
